---
bibliography: references.bib
csl: chicago.csl
output: html_document
always_allow_html: true
---

```{r, setup, echo=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  fig.width = 6,
  fig.asp = 0.618,
  out.width = "70%",
  fig.align = "center",
  dpi = 300
)
options(scipen = 999, digits = 4)
knitr::knit_hooks$set(
  inline = function(x) {
    if (is.numeric(x)) {
      return(formatC(x, big.mark = ",", format = "fg", digits = 2))
    } else{
      return(x)
    }
  }
)
```

```{r}
# libraries
library(tidyverse)
library(here)
library(cowplot)
library(ggeconodist)
library(gt)
```

## Results

### Uptake

```{r}
els_jns_df <- readr::read_csv(here::here("data", "elsevier_apc_list.csv"))
els_jns <- readr::read_csv(here::here("data", "els_historic_jns.csv")) 
els_jns_count <- els_jns %>%
  group_by(year, oa_model) %>%
  count(year) %>%
  group_by(year) %>%
  mutate(prop = n / sum(n)) %>%
  mutate(oa_model_fct = fct_rev(as_factor(oa_model))) 
```

#### How many Elsevier journals supported the hybrid model?

```{r}
els_overall <- els_jns %>% 
  group_by(oa_model) %>% 
  summarise(n = n_distinct(issn))
```

Using text-mined data from web-archived Elsevier APC pricing lists  [@Matthias_2020], we were able to determine the evolution of Elsevier's open access journal portfolio. Figure shows that the majority of journals were hybrid journals. Overall, Elsevier published `r length(unique(els_jns$issn))` open access journals, of which `r els_jns %>%  filter(oa_model == "Hybrid") %>% distinct(issn) %>% nrow()` supported the hybrid model.

Elsevier's journal portfolio changed over the period of observation. The number of hybrid journals grew by  `r (els_jns_count %>% filter(oa_model == "Hybrid", year == 2020) %>% .$n) - (els_jns_count %>% filter(oa_model == "Hybrid", year == 2015) %>% .$n)` journals between 2015 and May 2020, while its proportion relative to Elsevier's overall journal portfolio slightly decreased from `r round(els_jns_count %>% filter(oa_model == "Hybrid", year == 2015) %>% .$prop, 2) * 100`% to `r round(els_jns_count %>% filter(oa_model == "Hybrid", year == 2020) %>% .$prop, 2) * 100`%. The year 2016 marked the highest number of journals. After that, the trend reversed. Since 2018, the number of journals stagnated. On 23 May 2020, Elsevier APC pricing list comprised `r length(unique(els_jns_df$issn))` journals, of which `r els_jns_df %>% filter(oa_type == "Hybrid") %>% distinct(issn) %>% nrow()` supported the hybrid model, representing a share of `r round(els_jns_df %>% filter(oa_type == "Hybrid") %>% distinct(issn) %>% nrow() / length(unique(els_jns_df$issn)) * 100, 0)`%.

```{r}
ggplot(els_jns_count,
       aes(as.character(year), n,  fill = oa_model_fct, group = oa_model_fct)) +
  geom_area(alpha = 0.8,
            colour = "white") +
  scale_fill_manual(
    values = c("#cccccca0", "#56b4e9"),
    name = NULL,
    labels = c("Fully", "Hybrid")
  ) +
  labs(x = "Year", y = "Elsevier Journals") +
  scale_y_continuous(
    labels = scales::number_format(big.mark = ","),
    expand = expansion(mult = c(0, 0.05)),
    breaks =  scales::extended_breaks()
  ) +
  theme_minimal_hgrid() +
  theme(legend.position = "top",
        legend.justification = "right") +
  guides(fill = guide_legend("OA Business Model"))
```

#### How many of hybrid journals flipped to fully open access? 

```{r}
flipped_jns <- els_jns %>%
  distinct(issn, oa_model) %>%
  group_by(issn) %>%
  filter(n() > 1)
flipped_jns_ind <- els_jns %>%
  filter(issn %in% flipped_jns$issn) %>%
  group_by(issn) %>%
  slice(which.max(year)) %>%
  ungroup() %>%
  count(oa_model)
```

Following the approach of our earlier study [@Matthias_2019], we started with APC pricing list information to determine the number of open access business model flips between 2015-2020. Although the transition from hybrid to a fully open access business model has drawn most attention, also the reverse can be observed. A total number of `r sum(flipped_jns_ind$n)` journals changed the business model under the ownership of Elsevier. Of these, `r filter(flipped_jns_ind, oa_model == "Open Access")$n` journals flipped to fully open access, while `r filter(flipped_jns_ind, oa_model != "Open Access")$n` changed to hybrid open access. Examples for such reverse flipped open access journals include the physical journal *Materials Today* and the life science journal *Meta Gene*.

#### What is the uptake of open access in Elsevier's current hybrid journal portfolio?

*Number and percentage of journals with at least one article*

```{r}
els_jns_df <- readr::read_csv(here::here("data", "elsevier_apc_list.csv"))
```

```{r}
# paratext pattern
para <- c('^Author Index$|^Back Cover|^Contents$|^Contents:|^Cover Image|^Cover Picture|^Editorial Board|^Front Cover|^Frontispiece|^Inside Back Cover|^Inside Cover|^Inside Front Cover|^Issue Information|^List of contents|^Masthead|^Title page')
```

```{r}
hybrid_md <- readr::read_csv(here::here("data", "hybrid_md.csv"))
els_tdm <- readr::read_csv(here::here("data", "els_tmd_links.csv"))
invoice_df <-  readr::read_csv(here::here("data", "invoice_df.csv"))

hybrid_df <- els_tdm %>% 
  select(doi, URL) %>% 
  inner_join(invoice_df, by = c("URL" = "tdm_url")) %>% 
  select(-URL) %>% 
  inner_join(hybrid_md, by = c("doi")) %>% 
  distinct() %>%
  filter(!grepl(para, title))

flipped_jns_df <- els_jns %>%
  filter(issn %in% flipped_jns$issn) %>%
  select(oa_model, issn, year)

hybrid_df <- left_join(hybrid_df, flipped_jns_df, by = c("issn", "issued_year" = "year")) %>%
  filter(!oa_model %in% "Open Access") %>%
  select(-oa_model)
```

To determine the number of Elsevier hybrid journals with at least one open access article, we focused on the most current version of Elsevier's APC pricing list, lastly updated on 23 May 2020 [@Matthias_2020]. We used the Crossref index to determine the overall article volume of Elsevier's hybrid journal portfolio, and related it to the number of open access articles indicated by Creative Commons licenses. We only considered open access articles that were provided without delay, which we determined from mined full-text metadata. Because Elsevier also issued DOIs to non-scholarly journal content including table of contents and list of reviewers, we excluded these records using Unpaywall's paratext recognition approach [^1]. They account for about 2.5% of DOIs registered by Crossref.

[^1]: <https://support.unpaywall.org/support/solutions/articles/44001894783-what-does-is-paratext-mean-in-the-api->

On 23 May 2020, Elsevier APC pricing list comprised `r els_jns_df %>% filter(oa_type == "Hybrid") %>% distinct(issn) %>% nrow()` journals that supported the hybrid model. Of those, `r hybrid_df %>% filter(oa_archive == FALSE) %>% distinct(issn) %>% nrow()` hybrid journals published at least one open access article under a Creative Commons license between 2015 and 2019, corresponding to about `r round(hybrid_df %>% filter(oa_archive == FALSE) %>% distinct(issn) %>% nrow() / els_jns_df %>% filter(oa_type == "Hybrid") %>% nrow() * 100, 0)`% of journal titles in Elsevierâ€™s hybrid journal portfolio. At the same time, `r 100 - round(hybrid_df %>% filter(oa_archive == FALSE) %>% distinct(issn) %>% nrow() / els_jns_df %>% filter(oa_type == "Hybrid") %>% nrow() * 100, 0)`% of hybrid journals did not published an open access article.

```{r}
eligible_jns <- hybrid_df %>% 
  filter(oa_archive == FALSE) %>% 
  distinct(issn)
```

*Number and percentage of immediate open access articles per hybrid journal*

```{r}
# required data spreadsheets
# pub volume
els_pub_volume <- readr::read_csv(
  here::here("data", "article_volume_para.csv")
  ) 
# eligble journals 
eligible_jns <- hybrid_df %>% 
  filter(oa_archive == FALSE) %>% 
  distinct(issn)
# pub volume eligble data
hybrid_volume <- els_pub_volume %>%
  filter(issn %in% eligible_jns$issn) %>%
  inner_join(hybrid_df, by = c("issn", "issued_year")) %>%
  filter(oa_archive == FALSE)
# backup 
write_csv(hybrid_volume, here::here("data", "hybrid_volume_eligible.csv"))

els_articles <- 
  hybrid_volume %>%
  distinct(issued_year, issn, articles) %>%
  group_by(issued_year) %>%
  summarise(
    articles_n = sum(articles),
            articles_mean = mean(articles),
            articles_sd = sd(articles)
    )
els_yr <- 
  hybrid_volume %>%
  group_by(issued_year) %>%
  summarise(journals = n_distinct(issn)) %>%
  inner_join(els_articles, by = "issued_year")

# oa
oa_per_jn_year <- hybrid_volume %>%
  group_by(issued_year, issn) %>%
  summarise(oa = n(), .groups = "drop")
oa_ind <- oa_per_jn_year %>%
  group_by(issued_year) %>%
  summarise(oa_n = sum(oa),
            oa_mean = mean(oa),
            oa_sd = sd(oa)) 
# oa uptake 
oa_uptake_ind <- hybrid_volume %>% 
  distinct(issued_year, issn, articles) %>%
  inner_join(oa_per_jn_year, by = c("issn", "issued_year")) %>%
  mutate(prop = oa / articles) %>%
  group_by(issued_year) %>%
  summarise(oa_uptake_mean = mean(prop),
            oa_uptake_sd = sd(prop))
# oa uptake all 
oa_uptake_15_19 <- hybrid_volume %>% 
  distinct(issued_year, issn, articles) %>%
  inner_join(oa_per_jn_year, by = c("issn", "issued_year")) %>%
    group_by(issn) %>%
    summarise(oa = sum(oa),
              articles = sum(articles)) %>%
    mutate(prop = oa / articles) 

# all 
total_df <- tibble::tibble(
  issued_year = "2015-19",
  journals = hybrid_volume %>% distinct(issn) %>% nrow(),
  articles_n = hybrid_volume %>% distinct(issn, articles, issued_year) %>% pull(articles) %>% sum(),
  articles_mean = hybrid_volume %>% distinct(issn, articles, issued_year) %>% pull(articles) %>% mean(),
  articles_sd = hybrid_volume %>% distinct(issn, articles, issued_year) %>% pull(articles) %>% sd(),
  oa_n = nrow(hybrid_volume),
  oa_mean = hybrid_volume %>% group_by(issn) %>% summarise(oa = n()) %>% pull(oa) %>% mean(),
  oa_sd = hybrid_volume %>% group_by(issn) %>% summarise(oa = n()) %>% pull(oa) %>% sd(),
  oa_uptake = oa_n / articles_n,
  oa_uptake_mean = mean(oa_uptake_15_19$prop),
  oa_uptake_sd = sd(oa_uptake_15_19$prop)
         )

ind_df <- inner_join(els_yr, oa_ind, by = "issued_year") %>%
  mutate(oa_uptake = oa_n / articles_n) %>%
  inner_join(oa_uptake_ind, by = "issued_year") %>%
  mutate(issued_year = as.character(issued_year)) %>%
  bind_rows(total_df) %>%
  mutate(oa_uptake = oa_uptake * 100) %>%
  mutate(oa_uptake_mean = oa_uptake_mean * 100) %>%
  mutate(oa_uptake_sd = oa_uptake_sd * 100)

ind_summary_table <- ind_df %>% 
  pivot_longer(journals:oa_uptake_sd, names_to = "indicator", values_to = "count") %>%
  pivot_wider(names_from = issued_year, values_from = count)
```

Overall, `r total_df$journals` hybrid journals provided immediate open access to `r total_df$oa_n` articles between 2015 and 2019. The total share of hybrid open access in the publication volume of Elsevier journals was `r total_df$oa_uptake * 100`%. Table present the high-level findings by year, illustrating a moderate growth in hybrid open access. Although the number of hybrid journals with at least one open access article remained somehow constant, the number of open access articles rose substantially from `r ind_df %>% filter(issued_year == "2015") %>% pull(oa_n)` (2015) to `r ind_df %>% filter(issued_year == "2019") %>% pull(oa_n)` (2019). However, the overall uptake of open access in Elsevier's hybrid journal portfolio grew slowly from `r ind_df %>% filter(issued_year == 2015) %>% pull(oa_uptake)`% (2015) to `r ind_df %>% filter(issued_year == 2019) %>% pull(oa_uptake)`% (2019), because the number of articles published also increased during this five-years period.

```{r}
table_descriptives_ind <- tribble(
  ~ind_group, ~ind, ~ind_name,
  "Hybrid Journals with OA articles", "journals", "Journals",
  "Publication Volume", "articles_n", "Articles",
  "Publication Volume", "articles_mean", "Mean",
  "Publication Volume", "articles_sd", "SD",
  "OA Volume", "oa_n", "OA Articles",
  "OA Volume", "oa_mean", "Mean per Journal",
  "OA Volume", "oa_sd", "SD",
  "OA Uptake (in%)", "oa_uptake", "OA Percentage",
  "OA Uptake (in%)", "oa_uptake_mean", "Mean per Journal",
  "OA Uptake (in%)", "oa_uptake_sd", "SD"
)
inner_join(table_descriptives_ind, ind_summary_table, by = c("ind" = "indicator")) %>%
  dplyr::select(-ind) %>%
  gt(rowname_col = "ind_name", groupname_col = "ind_group") %>%
  fmt_number(contains("20"), decimals = 2) %>%
  fmt_number(contains("20"), 
             rows = c("Journals", "Articles", "OA Articles"),
             decimals = 0) %>%
  tab_style(cell_text(weight = "bold"),
            locations = cells_row_groups()
  )
```

*variation*

```{r}
els_jn_pub_volume <- els_pub_volume %>%
  filter(issn %in% eligible_jns$issn) %>%
  group_by(issued_year, issn) %>%
  summarise(articles = sum(articles),
            journals = n_distinct(issn))
hybrid_oa_per_jn <- hybrid_df %>%
  filter(oa_archive == FALSE) %>%
  group_by(issued_year, issn) %>%
  summarise(oa_articles = n())%>%
  inner_join(els_jn_pub_volume, by = c("issued_year", "issn")) %>%
  ungroup() %>%
  mutate(prop = oa_articles / articles) 
```

```{r}
perc_df <- hybrid_oa_per_jn %>%
  group_by(issued_year) %>% 
  summarize(median = median(prop),
            p_10 = quantile(prop, 0.1),
            p_95 = quantile(prop, 0.95),
            iqr = quantile(prop, 3/4) - quantile(prop, 1/4)) %>%
  ungroup()
```

Figure presents to which extent open access uptake rates varied among Elsevier hybrid journals between 2015 and 2019. The box-and-whiskers plot displays the distribution of the open access percentage per journal broken down by year. It visualizes the median open access proportion in the journal sample, the range of the majority of journals, and individual outliers represented as dots. Notably, upper quartiles and whiskers stretch farther over the years, indicating that the range of uptake among journals with an above-average proportion of open access articles increased over the years. Nevertheless, the prevalence of open access even among these journals can be described as relatively low; in 2019, 95% of Elsevier hybrid journals published `r perc_df %>% filter(issued_year == 2019) %>% pull(p_95) * 100`% or less open access articles. 


```{r}
ggplot(hybrid_oa_per_jn, aes(factor(issued_year), prop)) + 
  geom_boxplot() + 
  coord_cartesian(ylim=c(0,0.18)) +
  theme_minimal_hgrid() +
  scale_y_continuous(labels = scales::percent_format(accuracy = 5L),
      expand = expansion(mult = c(0, 0.05))) +
  labs(x = "Publication Years",
       y = "Open Access Uptake")
# licenses used
```

*Licenses used*

```{r}
# per year
yrl_volume <- hybrid_oa_per_jn %>% 
  group_by(issued_year) %>% 
  summarise(articles = sum(articles))

hybrid_license <- hybrid_volume %>%
  filter(oa_archive == FALSE) %>%
  mutate(cc_norm = ifelse(grepl("/by/", URL), "cc-by", "cc-by-nc")) %>%
  group_by(cc_norm, issued_year) %>%
  summarise(cc_articles = n())
```

Figure presents a breakdown by Creative Commons license variant used for hybrid open access by year. Elsevier provided commercial (cc-by) and a less permissive non-commercial license (cc-by-nc) for open access publishing in otherwise subscription-based journals. Nearly two-third of open access articles (`r  round(hybrid_license %>% group_by(cc_norm) %>% summarise(n = sum(cc_articles)) %>% mutate(prop = n / sum(n)) %>% filter(cc_norm == "cc-by-nc") %>% pull(prop) * 100,0)`%) can be re-used for non-commercial purposes. This proportion remained the same between 2015-19.

```{r}
hybrid_license %>%
  ggplot(aes(factor(issued_year), cc_articles, fill = cc_norm, group = cc_norm)) +
  geom_area(stat = "identity",
            color = "white",
            alpha = 0.8) +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.05)),
    labels = function(x)
        format(x, big.mark = ",", scientific = FALSE),
      breaks = scales::pretty_breaks()
  ) +
  scale_fill_manual(values = 
                      c(`cc-by` = "#0093c7",
  `cc-by-nc` = "#B52141")) +
  labs(x = "Publication year", y = "Total OA articles") +
  theme_minimal_hgrid() +
  theme(legend.position = "top",
        legend.justification = "right") +
  guides(fill = guide_legend("Creative Commons license variant"))
````

*Relationship to full and delayed OA?*




